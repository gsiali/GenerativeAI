# E-commerce Order Processing System Knowledge Base

## Function: calculate_order_total
### Description
Calculates the final total cost of a customer's order by applying volume discounts and adding shipping fees based on the cart value.
### Input
* **subtotal (float):** The sum of prices of all items in the cart.
* **is_member (boolean):** Indicates if the customer has a premium membership.
### Process
1. Initialize `discount_rate` to 0.0.
2. Check if `subtotal` is greater than 100.0.
   * If yes, set `discount_rate` to 0.10 (10% discount).
   * Otherwise, check if `subtotal` is greater than 50.0.
     * If yes, set `discount_rate` to 0.05 (5% discount).
3. Check if `is_member` is True.
   * If yes, add an additional 0.05 to the `discount_rate`.
4. Calculate `discount_amount` as `subtotal` * `discount_rate`.
5. Calculate `final_total` by subtracting `discount_amount` from `subtotal`.
6. Check if `final_total` is less than 30.0.
   * If yes, add 5.0 (shipping fee) to `final_total`.
7. Return `final_total`.
### Output
* **final_total (float):** The final amount the customer must pay.

---

## Function: validate_inventory_stock
### Description
Checks if there is enough stock to fulfill a customer's request and updates the inventory records accordingly.
### Input
* **requested_qty (integer):** The number of units the customer wants to buy.
* **current_stock (integer):** The number of units currently available in the warehouse.
### Process
1. Initialize `status` string to "Pending".
2. Check if `requested_qty` is less than or equal to 0.
   * If yes, return "Invalid Quantity" immediately.
3. Check if `requested_qty` is greater than `current_stock`.
   * If yes, set `status` to "Out of Stock".
   * Return `status`.
4. Otherwise (if stock is sufficient), subtract `requested_qty` from `current_stock` to get `new_stock`.
5. Check if `new_stock` is less than 5.
   * If yes, set `status` to "Order Confirmed - Low Stock Warning".
   * Otherwise, set `status` to "Order Confirmed".
6. Return `status`.
### Output
* **status (string):** The result message of the inventory check.

---

## Function: process_refund_eligibility
### Description
Determines if a customer is eligible for a refund based on the number of days since purchase and the condition of the item.
### Input
* **days_since_purchase (integer):** How many days have passed since the order date.
* **item_condition (string):** The state of the returned item ("new", "opened", "damaged").
### Process
1. Initialize `is_eligible` to False.
2. Initialize `refund_percentage` to 0.0.
3. Check if `days_since_purchase` is greater than 30.
   * If yes, return a tuple (False, 0.0) immediately.
4. Check the `item_condition`:
   * If "new", set `is_eligible` to True and `refund_percentage` to 1.0 (100%).
   * Else if "opened", set `is_eligible` to True and `refund_percentage` to 0.8 (80%).
   * Else ("damaged"), set `is_eligible` to False.
5. Return a tuple containing `is_eligible` and `refund_percentage`.
### Output
* **result (tuple):** Contains a boolean for eligibility and a float for the refund amount.

---

## Function: generate_shipping_label
### Description
Generates a shipping label code based on the destination region and package weight. It validates that the weight is within acceptable limits.
### Input
* **region_code (string):** The destination code (e.g., "NA", "EU", "ASIA").
* **weight_kg (float):** The weight of the package in kilograms.
### Process
1. Check if `weight_kg` is greater than 20.0.
   * If yes, return "Error: Overweight" immediately.
2. Initialize `label_prefix` to empty string.
3. Check `region_code`:
   * If "NA", set `label_prefix` to "US-".
   * Else if "EU", set `label_prefix` to "EURO-".
   * Otherwise, set `label_prefix` to "INTL-".
4. Convert `weight_kg` to a string format.
5. Concatenate `label_prefix` with the string version of `weight_kg` to create `label`.
6. Return `label`.
### Output
* **label (string):** The generated shipping code string.

---

## Function: batch_update_prices
### Description
Iterates through a list of product prices and applies a seasonal markup to all items, calculating the potential revenue increase.
### Input
* **price_list (list of floats):** Current prices of products in a category.
* **markup_percentage (float):** The percentage to add to each price (e.g., 0.10 for 10%).
### Process
1. Initialize an empty list `new_prices`.
2. Initialize `total_revenue_increase` to 0.0.
3. Start a Loop to iterate through each `price` in `price_list`:
   * Calculate `increase` as `price` * `markup_percentage`.
   * Add `increase` to `total_revenue_increase`.
   * Calculate `new_price` as `price` + `increase`.
   * Append `new_price` to the `new_prices` list.
4. Return a dictionary containing the `new_prices` list and the `total_revenue_increase`.
### Output
* **summary (dictionary):** Contains the updated list and the total projected gain.

---

## Function: calculate_loyalty_points
### Description
Calculates the number of reward points a customer earns from a purchase, applying multipliers based on their membership tier.
### Input
* **order_value (float):** The total amount spent in the current order.
* **tier (string):** The customer's membership level ("Gold", "Silver", "Bronze").
### Process
1. Initialize `multiplier` to 1.0.
2. Check the `tier`:
   * If "Gold", set `multiplier` to 3.0.
   * Else if "Silver", set `multiplier` to 2.0.
   * Otherwise, set `multiplier` to 1.0.
3. Calculate `points` as `order_value` * `multiplier`.
4. Check if `order_value` is greater than 500.0.
   * If yes, add 100 bonus points to `points`.
5. Return the integer value of `points`.
### Output
* **points (integer):** The total loyalty points earned.

---

## Function: evaluate_fraud_risk
### Description
Analyzes transaction details to assign a risk score. Used to flag potentially fraudulent orders for manual review.
### Input
* **is_international (boolean):** True if shipping address is in a different country than billing.
* **order_total (float):** The total value of the transaction.
* **failed_attempts (integer):** Number of failed payment attempts before success.
### Process
1. Initialize `risk_score` to 0.
2. Check if `is_international` is True.
   * If yes, add 30 to `risk_score`.
3. Check if `order_total` is greater than 1000.0.
   * If yes, add 20 to `risk_score`.
4. Check if `failed_attempts` is greater than 2.
   * If yes, add 40 to `risk_score`.
5. Check if `risk_score` is greater than or equal to 50.
   * If yes, return "High Risk".
   * Otherwise, return "Low Risk".
### Output
* **risk_level (string):** The categorical assessment of the transaction.

---

## Function: filter_promotional_items
### Description
Scans a list of items in a user's cart and extracts only the items that are currently valid for a "Summer Sale" promotion.
### Input
* **cart_items (list of dictionaries):** A list where each item has an "id", "name", and a boolean "is_promo".
### Process
1. Initialize an empty list `promo_list`.
2. Start a Loop to iterate through each `item` in `cart_items`:
   * Check if `item["is_promo"]` is True.
   * If yes, append the `item["name"]` to `promo_list`.
3. Check if `promo_list` is empty.
   * If yes, return "No Promo Items Found".
4. Return `promo_list`.
### Output
* **result (list or string):** A list of item names or a status message.

---

## Function: calculate_import_taxes
### Description
Estimates the import duties for an international shipment based on the destination country and product category.
### Input
* **destination (string):** The country code (e.g., "UK", "CA", "JP").
* **category (string):** The type of product (e.g., "Electronics", "Clothing").
* **value (float):** The declared value of the item.
### Process
1. Initialize `tax_rate` to 0.05 (base rate).
2. Check if `destination` is "UK".
   * If yes, add 0.15 to `tax_rate`.
3. Check if `category` is "Electronics".
   * If yes, add 0.05 to `tax_rate`.
   * Else if `category` is "Clothing", add 0.10 to `tax_rate`.
4. Calculate `total_tax` as `value` * `tax_rate`.
5. Return `total_tax`.
### Output
* **total_tax (float):** The estimated tax amount.

---

## Function: check_cart_weight_limit
### Description
Iterates through all items in a cart to calculate total weight and ensures it does not exceed the carrier's maximum limit.
### Input
* **item_weights (list of floats):** A list of weights for every item in the cart.
* **max_limit (float):** The maximum weight allowed by the selected shipping carrier.
### Process
1. Initialize `total_weight` to 0.0.
2. Start a Loop to iterate through each `w` in `item_weights`:
   * Add `w` to `total_weight`.
3. Check if `total_weight` is greater than `max_limit`.
   * If yes, return False.
   * Otherwise, return True.
### Output
* **is_allowed (boolean):** True if shipment is within limits, False if overweight.